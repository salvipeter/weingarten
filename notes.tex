\documentclass[a4paper]{article}

\usepackage{amsmath}

\begin{document}
\title{Weingarten maps}
\author{P\'eter Salvi}
\maketitle

Let $\mathcal{S}$ denote an operator on a surface such that $\mathcal{S}(\mathbf{w})$ is the
(negated) derivative of the unit normal by $\mathbf{w}$, i.e., for a fixed
point $\mathbf{p}$ of the surface $\mathbf{x}(u,v)$,
\[\mathcal{S}(\mathbf{w})=-\nabla_{\mathbf{w}}\,\mathcal{G},\]
where $\mathcal{G}$ is the Gauss map of the surface, and $\mathbf{w}$ is a
vector in the tangent plane. This is the \emph{shape operator}, or
Weingarten map---a symmetric, linear operator, expressible by a
$2\times2$ matrix (which is also symmetric when the basis vectors are
perpendicular). Note that $\mathcal{S}$ is independent of the parameterization
of $\mathbf{x}$ as long as the basis it is expressed in is
parameterization-independent.

This matrix has very nice properties:
\begin{align*}
  k(\mathbf{w})&=\langle \mathcal{S}(\mathbf{w}),\mathbf{w}\rangle&&\text{(normal curvature)}\\
  K&=|\mathcal{S}|,&&\text{(Gaussian curvature)}\\
  H&=\mathrm{tr}(\mathcal{S})/2,&&\text{(mean curvature)}
\end{align*}
and also the principal curvatures $\kappa_1$, $\kappa_2$ are the
eigenvalues of $\mathcal{S}$, and the principal directions $\mathbf{e}_1$,
$\mathbf{e}_2$ are the corresponding eigenvectors (expressed in the
basis of the matrix).

If we write the matrix of $\mathcal{S}$ in the basis $\mathbf{e}_1$,
$\mathbf{e}_2$, then the above properties become obvious:
\begin{equation}
  \mathcal{S}=
  \begin{pmatrix}
    \kappa_1 & 0 \\
    0 & \kappa_2
  \end{pmatrix}.
  \label{eq:S}
\end{equation}
But this offers little help when we do not \emph{know} these values.

Luckily $\mathcal{S}$ is easily expressible in the basis of the derivatives of
$\mathbf{x}$:
\begin{equation}
  \mathcal{S}=\mathbf{I}^{-1}\mathbf{I\!I},
  \label{eq:S2}
\end{equation}
where $\mathbf{I}$ and $\mathbf{I\!I}$ are the first and second fundamental forms:
\begin{align*}
  \mathbf{I} &= \begin{pmatrix}E&F\\F&G\end{pmatrix}, &
  \mathbf{I\!I} &= \begin{pmatrix}L&M\\M&N\end{pmatrix},
\end{align*}
\begin{align*}
  E &= \langle\mathbf{x}_u,\mathbf{x}_u\rangle, &
  F &= \langle\mathbf{x}_u,\mathbf{x}_v\rangle, &
  G &= \langle\mathbf{x}_v,\mathbf{x}_v\rangle,\\
  L &= \langle\mathbf{n},\mathbf{x}_{uu}\rangle, &
  M &= \langle\mathbf{n},\mathbf{x}_{uv}\rangle, &
  N &= \langle\mathbf{n},\mathbf{x}_{vv}\rangle,\\
  && \mathbf{n} &= \frac{\mathbf{x}_u\times\mathbf{x}_v}{\|{\mathbf{x}_u\times\mathbf{x}_v}\|}. &&
\end{align*}
The drawback is that now the matrix of $\mathcal{S}$ is not independent of the parameterization.

Take Eq.~(\ref{eq:S}) and add the unit normal $\mathbf{n}$ as a
third basis vector, i.e., using the basis ($\mathbf{e}_1$,
$\mathbf{e}_2$, $\mathbf{n}$), bringing it into 3D space:
\[
  \mathcal{W}=
  \begin{pmatrix}
    \kappa_1 & 0 & 0\\
    0 & \kappa_2 & 0\\
    0 & 0 & 0
  \end{pmatrix}.
\]
This is the \emph{embedded} Weingarten map, sometimes also called the
curvature tensor (but this term is abused). All the properties still
stand, except for the Gaussian curvature, which can be expressed as
\[K = \frac{\mathrm{tr}(\mathcal{W})^2-\mathrm{tr}(\mathcal{W}^2)}{2},\]
and that there is an extra $0$ eigenvalue; normal curvatures are
computed based on the projection of the given vector into the tangent plane.

Now we can also use the axes of 3D space as a basis---which is also
independent of parameterization---and write the matrix as
\begin{equation}
  \mathcal{W}=(\mathbf{J}^+)^\textsf{T}\cdot\mathbf{I\!I}\cdot\mathbf{J}^+,
  \label{eq:W}
\end{equation}
where $\mathbf{J}^+$ is the left pseudoinverse of the Jacobian:
\[\mathbf{J}^+=
(\mathbf{J}^\textsf{T}\mathbf{J})^{-1}\mathbf{J}^\textsf{T}=
\mathbf{I}^{-1}\mathbf{J}^\textsf{T}=
(\mathbf{J}\cdot\mathbf{I}^{-1})^\textsf{T}.\]
This formulation also has the advantage that its eigenvectors give the
principal directions directly expressed in 3D coordinates. Note that
while this matrix is exactly the same, independently of the
parameterization, in exchange it \emph{does} depend on the
coordinates, so e.g.~a rotation in 3D changes the elements of the
matrix.

\subsection*{Implicit surfaces}

For an implicitly defined surface $f(x,y,z)=0$ take two arbitrary
perpendicular vectors ($\mathbf{u}$,$\mathbf{v}$) in the tangent
plane, and let
\begin{align*}
  f_{uu}&=\mathbf{u}^\textsf{T}\mathbf{H}\,\mathbf{u}, &
  f_{uv}&=\mathbf{u}^\textsf{T}\mathbf{H}\,\mathbf{v}, &
  f_{vv}&=\mathbf{v}^\textsf{T}\mathbf{H}\,\mathbf{v},
\end{align*}
where $\mathbf{H}$ is the Hessian of $f$.
If we denote the norm of the gradient with $f_n=\|\nabla f\|$,
the shape operator can be expressed in ($\mathbf{u}$,$\mathbf{v}$) as
\begin{equation}
  \mathcal{S}=\frac{1}{f_n}
  \begin{pmatrix}
    f_{uu} & f_{uv} \\
    f_{uv} & f_{vv}
  \end{pmatrix}.
  \label{eq:S3}
\end{equation}
Solving the characteristic equation $(\mathcal{S}-\mathbf{I}_2\kappa_i)\mathbf{e}_i=0$ with $i\in\{1,2\}$ gives
\[
\mathbf{e}_i=\mathbf{u}f_{uv}+\mathbf{v}(\kappa_if_n-f_{uu})
\quad\text{or}\quad
\mathbf{e}_i=\mathbf{v}f_{uv}+\mathbf{u}(\kappa_if_n-f_{vv}),
\footnote{Care should be taken to choose the formula that does not result in a null vector.}
\]
so we can compute the principal directions without eigendecomposition,
since $\kappa_i$ can be derived from
\[\kappa_i=H\pm\sqrt{H^2-K}.\]

The embedded Weingarten map can be computed as
\begin{equation}
  \mathcal{W}=\frac{1}{\|\nabla f\|}\cdot\mathbf{T}\cdot\mathbf{H}\cdot\mathbf{T},
  \label{eq:W2}
\end{equation}
where $\mathbf{T}=\mathbf{I}_3-\mathbf{n}\mathbf{n}^\textsf{T}$ is the
orthogonal projector onto the tangent plane, with $\mathbf{n}=\nabla
f/\|\nabla f\|$ being the unit normal to the surface. Note that when
$\|\nabla f\|=1$ (i.e., when $f$ is a signed distance function), the embedded
Weingarten map is equal to the Hessian.

The formulas for the Gaussian and mean curvatures can be expressed succintly
as below:
\begin{align*}
  K &= \frac{\nabla f^\textsf{T} \cdot \mathrm{adj}(\mathbf{H}) \cdot \nabla f}{\|\nabla f\|^4},&
  H &= \frac{\|\nabla f\|^2 \cdot \mathrm{tr}(\mathbf{H})
  - \nabla f^\textsf{T} \cdot \mathbf{H} \cdot \nabla f}{2\|\nabla f\|^3}.
\end{align*}

Finally, a note on the sign of curvature values.
They are relative to the orientation of the normal vector;
conventionally they are defined such that in the implicit case
(Eqs.~\ref{eq:S3} and~\ref{eq:W2}) they
are positive when the surface curves \emph{away} from the normal direction,
while in the parametric case (Eqs.~\ref{eq:S2} and~\ref{eq:W})
the resulting curvatures have the opposite sign.

\section*{References}
On the shape operator, see any decent differential geometry textbook, e.g.:
\begin{itemize}
\item Barrett O'Neill, 2006:
  \emph{Elementary Differential Geometry}\\
  (Elsevier, Revised 2nd Edition).
\item Andrew Pressley, 2010:
  \emph{Elementary Differential Geometry}\\
  (Springer, 2nd Edition).
\item Wolfgang K\"uhnel, 2015:
  \emph{Differential Geometry: Curves---Surfaces---Manifolds}\\
  (AMS, 3rd Edition, trans.~by Bruce Hunt).
\end{itemize}
On the embedded Weingarten map, see
\begin{itemize}
\item J\"org Peters \& Ulrich Reif, 2008:
  \emph{Subdivision Surfaces}\\
  (Springer).
\end{itemize}
Finally, on the curvatures of implicit surfaces, see the following papers:
\begin{itemize}
\item Ron Goldman, 2005:
  \emph{Curvature formulas for implicit curves and surfaces}\\
  (Computer Aided Geometric Design 22(7), pp.~632--658).
\item Nicole Lehmann \& Ulrich Reif, 2012:
  \emph{Notes on the curvature tensor}\\
  (Graphical Models 74(6), pp.~321--325).
\item Eric Albin \&al., 2017:
  \emph{Computational assessment of curvatures and principal directions of implicit surfaces from 3D scalar data}\\
  (Mathematical Methods for Curves and Surfaces [LNCS 10521], pp.~1--22).
\end{itemize}
\end{document}
